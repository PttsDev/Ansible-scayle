---
- name: Install NTP packet
  ansible.builtin.apt:
    name: ntp
    state: present

- name: Install ntpdate packet
  ansible.builtin.apt:
    name: ntpdate
    state: present

# Se para antes de sincronizar la hora
- name: Stop NTP service
  ansible.builtin.service:
    name: ntp
    state: stopped

- name: Sincronize current time with NTP server
  ansible.builtin.command: ntpdate {{ servidor_ntp }}

- name: Configure NTP file
  ansible.builtin.lineinfile:
    path: /etc/ntp.conf
    regexp: "^server"
    line: "server {{ servidor_ntp }}"
    state: present

# Se inicia el servicio tras la configuraci√≥n
- name: Start NTP service
  ansible.builtin.service:
    name: ntp
    state: started
